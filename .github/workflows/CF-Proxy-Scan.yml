name: CF Proxy scan

on:
  # Workflow dapat dijalankan secara manual
  workflow_dispatch:


jobs:
  update-proxies:
    runs-on: ubuntu-latest
    name: Scan Proxy

    steps:
    - name: 📂 Checkout Repository
      uses: actions/checkout@v3
      with:
       token: ${{ secrets.GIT_TOKEN }}
    
    - name: 🐍 Set Up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: 📦 Install Dependencies
      run: |
        python -m pip install aiohttp --upgrade 
        
    
    - name: RUN CF Proxy Scan
      run: |
        python3 ./src/main.py

    #Commit dan push perubahan jika ada
    - name: 📤 Commit and Push Changes
      if: ${{ success() }}
      run: |
        git config --global user.name "Github Actions"
        git config --global user.email "actions@github.com"
        git add .
        if ! git diff --staged --quiet; then
        echo "Perubahan terdeteksi. Melakukan commit..."
        git commit -m "🔁 Update proxyip"
        git push origin main --force
        else
        echo "Tidak ada perubahan untuk di-commit. Working tree bersih."
        fi
      shell: bash # Pastikan Anda menentukan bash jika Anda bergantung pada fitur bash seperti konstruksi if !
             # Opsi -e seringkali merupakan default atau diatur di tingkat workflow/job.
             # Jika -e aktif, logika kondisional ini menangani kasus "tidak ada perubahan" dengan baik.
