name: CF Proxy Scan

on:
  workflow_dispatch:

jobs:
  update-proxies:
    runs-on: ubuntu-latest
    name: 🔎 Scan Proxy (Rust Binary)

    steps:
    - name: 📂 Checkout Repository
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GIT_TOKEN }}

    - name: 🧪 Give Execute Permission to Binary
      run: chmod +x ./cf_checker

    - name: 🚀 Run Rust Binary
      run: ./cf_checker

    - name: 📤 Commit and Push Changes
      if: ${{ success() }}
      run: |
        git config --global user.name "Github Actions"
        git config --global user.email "actions@github.com"
        git add .
        if ! git diff --staged --quiet; then
          echo "Perubahan terdeteksi. Melakukan commit..."
          git commit -m "🔁 Update proxyip"
          git push origin main --force
        else
          echo "Tidak ada perubahan untuk di-commit. Working tree bersih."
        fi
      shell: bash
